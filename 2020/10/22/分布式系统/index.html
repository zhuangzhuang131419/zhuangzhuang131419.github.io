

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="zhuangzhuang">
  <meta name="keywords" content="">
  <title>分布式系统 - Hexo</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"zhuangzhuang131419.github.io","root":"/","version":"1.8.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.3.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Fluid</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="分布式系统">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2020-10-22 18:25" pubdate>
        2020年10月22日 晚上
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      3.7k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      38
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">分布式系统</h1>
            
            <div class="markdown-body">
              <p>这篇学习笔记是针对 MIT 6.824 Distributed System. B站链接 <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av91748150/">https://www.bilibili.com/video/av91748150/</a></p>
<h1 id="分布式系统"><a href="#分布式系统" class="headerlink" title="分布式系统"></a>分布式系统</h1><ul>
<li>核心是通过网络是一群计算机相互通信来完成一些连贯的任务</li>
<li>使用分布式系统的原因<ul>
<li>实现并行</li>
<li>容错</li>
<li>物理上的原因（两台计算机处于不同的地理位置）</li>
<li>考虑到安全性</li>
</ul>
</li>
<li>分布式系统的挑战<ul>
<li>部分故障</li>
<li>提升性能</li>
</ul>
</li>
</ul>
<h2 id="基础架构"><a href="#基础架构" class="headerlink" title="基础架构"></a>基础架构</h2><ul>
<li>存储 (最为关注)</li>
<li>通信</li>
<li>计算</li>
</ul>
<p>目标：能够从分布式存储和计算(computation)基础结构中发现一些可抽象的东西并设计为接口以简化使用</p>
<h1 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h1><h2 id="RPC"><a href="#RPC" class="headerlink" title="RPC"></a>RPC</h2><h2 id="threads"><a href="#threads" class="headerlink" title="threads"></a>threads</h2><h2 id="concurrency"><a href="#concurrency" class="headerlink" title="concurrency"></a>concurrency</h2><h1 id="性能-Performance"><a href="#性能-Performance" class="headerlink" title="性能 Performance"></a>性能 Performance</h1><h2 id="可扩展性-scalability"><a href="#可扩展性-scalability" class="headerlink" title="可扩展性 scalability"></a>可扩展性 scalability</h2><p>使用两倍的计算机或资源就能使我获得两倍的性能或吞吐量</p>
<h1 id="容错-Fault-Tolerance"><a href="#容错-Fault-Tolerance" class="headerlink" title="容错 Fault Tolerance"></a>容错 Fault Tolerance</h1><h2 id="可用性-Availability"><a href="#可用性-Availability" class="headerlink" title="可用性 Availability"></a>可用性 Availability</h2><h2 id="可恢复性-Recoverability"><a href="#可恢复性-Recoverability" class="headerlink" title="可恢复性 Recoverability"></a>可恢复性 Recoverability</h2><h2 id="非易失性存储-Non-volatile-memory"><a href="#非易失性存储-Non-volatile-memory" class="headerlink" title="非易失性存储 Non-volatile memory"></a>非易失性存储 Non-volatile memory</h2><h2 id="复制-Replication"><a href="#复制-Replication" class="headerlink" title="复制 Replication"></a>复制 Replication</h2><p>目前流行的三种变更复制的算法: <code>单领导者</code>, <code>多领导者</code>, <code>无领导者</code></p>
<h3 id="领导者与追随者"><a href="#领导者与追随者" class="headerlink" title="领导者与追随者"></a>领导者与追随者</h3><p>存储数据库副本的每一个节点称为<strong>副本(replica)</strong>.</p>
<ul>
<li>基于领导者的复制 (leader-based replication)<ul>
<li>其中一个副本被指定为 leader. 当客户端要向数据库写入时, 他必须将请求发送给 leader, leader 会将新数据写入器本地存储.</li>
<li>其他副本被称为 followers. 每当 leader 将新数据写入本地存储时, 他也会将数据变更发送给所有的 followers, 这称为<strong>复制日志(replication log)</strong>. 每个 follower 从 leader 拉取日志, 并相应更新其本地数据库副本, 按照 leader 处理的相同顺序应用所有写入.</li>
<li>leader 是有读写操作的, 而 follower 只有读操作.</li>
</ul>
</li>
</ul>
<h4 id="同步复制与异步复制"><a href="#同步复制与异步复制" class="headerlink" title="同步复制与异步复制"></a>同步复制与异步复制</h4><p>复制的一个重要细节就是: 同步还是异步的.</p>
<blockquote>
<p><strong>半同步</strong>: 由于从库可能存在(崩溃, 网络故障)等一系列原因, 将所有从库都设置成同步是不切实际的. 实际上, 如果在数据库上启用同步复制, 这意味着通常只有一个 follower 是同步的, 而其他的都是异步的. 如果发现同步的 follower 变得不可用或是缓慢, 使一个异步的 follower 同步. 这样就可以保证至少有在两个节点上拥有最新的数据副本.</p>
</blockquote>
<h4 id="设置新从库"><a href="#设置新从库" class="headerlink" title="设置新从库"></a>设置新从库</h4><ol>
<li>在某个时刻获取主库的一致性快照, 而不必锁定整个数据库.</li>
<li>将快照复制到新的从库节点</li>
<li>从库连接到主库, 并拉取快照之后发生的所有数据变更. 这要求快照与主库复制日志中的位置精确关联.</li>
<li>当从库处理完快照之后积压的数据变更. 现在可以继续处理主库上的数据变化了.</li>
</ol>
<h4 id="处理节点宕机"><a href="#处理节点宕机" class="headerlink" title="处理节点宕机"></a>处理节点宕机</h4><ul>
<li>从库失效: 追赶恢复</li>
<li>主库失效: 故障切换<ul>
<li>其中一个从库需要被提升为新的主库, 需要重新配置客户端, 以将他们的写操作发送给新的主库, 其他从库需要开始拉取来自新主库的数据变更.</li>
</ul>
</li>
</ul>
<h4 id="复制日志的实现"><a href="#复制日志的实现" class="headerlink" title="复制日志的实现"></a>复制日志的实现</h4><ul>
<li>基于语句的复制<ul>
<li>任何调用非确定性函数的语句都会在每个副本上生成不同的值.例如 <code>NOW()</code>, <code>RAND()</code></li>
<li>如果语句使用了自增列, 则必须在每个副本上按照完全相同的顺序执行.</li>
<li>有副作用的语句可能会在每个副本上产生不同的副作用.</li>
</ul>
</li>
<li>传输预写式日志<ul>
<li>日志都是包含所有数据库写入的仅追加字节序列.</li>
</ul>
</li>
<li>逻辑日志复制<ul>
<li>以行的粒度描述对数据库表的写入<ul>
<li>对于插入的行，日志包含所有列的新值。</li>
<li>对于删除的行，日志包含足够的信息来唯一标识已删除的行。通常是主键，但是如果表上没有主键，则需要记录所有列的旧值。</li>
<li>对于更新的行，日志包含足够的信息来唯一标识更新的行，以及所有列的新值（或至少所有已更改的列的新值）。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="复制延迟的问题"><a href="#复制延迟的问题" class="headerlink" title="复制延迟的问题"></a>复制延迟的问题</h3><p>当应用程序从异步从库中读取数据的时候, 如果从库落后, 它可能会看到过时的消息. 但这种不一致只是一个暂时的状态 —— 如果停止写入数据库并等待一段时间, 从库最终会赶上主库并保持一致. 这种效应被称为 <strong>最终一致性 (eventually consistency)</strong></p>
<ul>
<li><p>读写一致性</p>
<ul>
<li>如果用户重新加载页面, 他们总会看到他们自己提交的任何更新。</li>
<li>读用户<strong>可能已经修改过</strong>的内容时, 强制都从主库读. (例如: 社交网络上的用户个人资料信息通常只能由用户本人编辑，而不能由其他人编辑. 因此一个简单的规则就是: 从主库读取用户自己的档案，在从库读取其他用户的档案)</li>
<li>如果应用中的大部分内容都被用户编辑了<ul>
<li>可以跟踪上次更新时间, 在上次更新后的一分钟内, 从主库读. </li>
<li>也可以监控从库的复制延迟, 防止向任意滞后超过一分钟的从库发起查询.</li>
</ul>
</li>
</ul>
</li>
<li><p>单调读</p>
<ul>
<li>用户首先从新副本读取, 然后从旧副本读取. 可能会发现前后读取不一致的情况</li>
<li>确保每个用户总是从同一个副本进行读取 (不同的用户可以从不同的副本读取)</li>
</ul>
</li>
<li><p>一致前缀读</p>
<ul>
<li>如果一系列写入按某个顺序发生, 那么任何人读取这些写入时, 也会看见它们以同样的顺序出现.</li>
<li>确保任何因果相关的写入都写入相同的分区.</li>
</ul>
</li>
</ul>
<h3 id="多主复制"><a href="#多主复制" class="headerlink" title="多主复制"></a>多主复制</h3><p>基于领导者的复制有一个主要的缺点：只有一个主库，而所有的写入都必须通过它。如果出于任何原因（例如和主库之间的网络连接中断）无法连接到主库, 就无法向数据库写入。</p>
<p>多领导者配置可以在每个数据中心都有主库, 每个数据中心内部使用常规的主从复制; 在数据中心之间, 每个数据中心的主库都会将其更改复制到其他数据中心的主库中.</p>
<h4 id="处理写入冲突"><a href="#处理写入冲突" class="headerlink" title="处理写入冲突"></a>处理写入冲突</h4><p>多领导者复制最大问题是可能发生写冲突, 这意味着需要解决冲突.</p>
<ul>
<li>避免冲突<ul>
<li>如果应用程序可以确保特定记录的所有写入都通过同一个 leader , 那么这个冲突就不会发生.</li>
</ul>
</li>
<li>收敛至一直的状态<ul>
<li>给每个写入一个唯一的 ID, 挑选最高 ID 的写入作为胜利者, 并丢弃其他写入. (LWW, last write wins)</li>
<li>以某种方式将这些值合并在一起.</li>
<li>在保留所有信息的显式数据结构中记录冲突, 并编写解决冲突的应用程序代码</li>
</ul>
</li>
</ul>
<h4 id="多主复制拓扑"><a href="#多主复制拓扑" class="headerlink" title="多主复制拓扑"></a>多主复制拓扑</h4><p>有两个以上的 leader, 各种不同的拓扑时可能的.</p>
<img src="/2020/10/22/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/%E5%A4%9A%E9%A2%86%E5%AF%BC%E6%8B%93%E6%89%91.png" srcset="/img/loading.gif" class="" title="多领导拓扑">

<ul>
<li>循环和星型拓扑的问题是, 如果只有一个结点发生故障, 则可能会中断其他节点之间的复制消息流, 导致无法通信, 直到节点修复.</li>
<li>全能拓扑也可能有问题. 一些网络连接可能比其他网络连接更快, 一些消息可能先于它所依赖的消息.<ul>
<li>可以使用版本向量(version vector)来解决.</li>
</ul>
</li>
</ul>
<h3 id="无主复制"><a href="#无主复制" class="headerlink" title="无主复制"></a>无主复制</h3><p>客户端直接将写入发送到几个副本中. 在无领导配置中, 故障切换不存在, 为了解决这个问题, 当一个客户端从数据库中读取数据的时候, 它不仅仅发送他的请求到一个副本; 读请求也被并行的发送到多个节点. 客户可能会从不同的节点获得不同的响应。即来自一个节点的最新值和来自另一个节点的陈旧值。版本号用于确定哪个值更新.</p>
<ul>
<li>法定人数<ul>
<li>如果有 n 个副本, 每个写入必须由 w 个节点确认才能被认为是成功的, 并且我们必须至少为每一个读取查询 r 个节点. (w + r &gt; n) 即可以保证在读取的节点中一定能够读取到最新的值.</li>
</ul>
</li>
</ul>
<p>如果两个操作都互相感觉不到对方的存在, 就称这两个操作<strong>并发</strong>.</p>
<p>服务器可以通过查看版本号来确定两个操作是否并发的</p>
<ol>
<li>服务器为每个键保留一个版本号，每次写入键时都增加版本号，并将新版本号与写入的值一起存储.</li>
<li>当客户端读取键时，服务器将返回所有未覆盖的值以及最新的版本号。客户端在写入前必须读取.</li>
<li>客户端写入键时，必须包含之前读取的版本号，并且必须将之前读取的所有值合并在一起.</li>
<li>当服务器接收到具有特定版本号的写入时，它可以覆盖该版本号或更低版本的所有值, 但是它必须保持所有值更高版本号.</li>
</ol>
<h3 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h3><ul>
<li><a target="_blank" rel="noopener" href="https://vonng.gitbooks.io/ddia-cn/content/ch5.html">设计数据密集型应用-第五章</a></li>
</ul>
<h2 id="分区-Partition"><a href="#分区-Partition" class="headerlink" title="分区 Partition"></a>分区 Partition</h2><p>分区是一种有意将大型数据库分解成小型数据库的方式.</p>
<blockquote>
<p>tips: 上文中的<strong>分区(partition)</strong>,在MongoDB,Elasticsearch和Solr Cloud中被称为<strong>分片(shard)</strong>,在HBase中称之为<strong>区域(Region)**，Bigtable中则是</strong>表块(tablet)<strong>，Cassandra和Riak中是</strong>虚节点(vnode)<strong>, Couchbase中叫做</strong>虚桶(vBucket)**.但是分区(partition) 是约定俗成的叫法。</p>
</blockquote>
<h3 id="分区与复制"><a href="#分区与复制" class="headerlink" title="分区与复制"></a>分区与复制</h3><p>不均衡导致的高负载的分区被称为热点(hot spot). 解决这个问题可以采用一些的办法</p>
<ul>
<li>根据键的范围分区<ul>
<li>为每个分区指定一块连续的键范围 (分区边界可以由管理员手动选择, 也可以由数据库自动选择)</li>
<li>缺点<ul>
<li>某些特定的访问模式会导致热点. (e.g., 主键是时间戳的话)</li>
</ul>
</li>
</ul>
</li>
<li>根据键的散列分区<ul>
<li>一个好的 hash function 可以将偏斜的数据均匀分布.</li>
<li>Java 中的 Object.hashCode() 和 Ruby 的 Object#hash, 同一个键可能在不同的进程中有不同的哈希值.</li>
<li>一致性哈希 <strong>(Consistent Hashing)</strong> <ul>
<li><a target="_blank" rel="noopener" href="http://www.zsythink.net/archives/1182">一致性哈希算法 consistent hashing</a></li>
</ul>
</li>
</ul>
</li>
<li>负载倾斜与消除热点<ul>
<li>如果一个主键被认为是非常火爆的, 可以在这个主键的开始或结尾添加一个随机数.</li>
<li>需要一些方法来跟踪哪些键需要被分割(否则对于吞吐量低的绝大多数主键来是不必要的开销)</li>
</ul>
</li>
</ul>
<h3 id="分片与次级索引"><a href="#分片与次级索引" class="headerlink" title="分片与次级索引"></a>分片与次级索引</h3><h4 id="按文档的次级索引"><a href="#按文档的次级索引" class="headerlink" title="按文档的次级索引"></a>按文档的次级索引</h4><img src="/2020/10/22/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/%E6%8C%89%E6%96%87%E6%A1%A3%E7%9A%84%E4%BA%8C%E7%BA%A7%E7%B4%A2%E5%BC%95.png" srcset="/img/loading.gif" class="" title="按文档的二级索引">

<p>每个分区完全独立: 每个分区维护自己的二级索引, 仅覆盖该分区中的文档. 所以也被称为<strong>本地索引(local index)</strong>.</p>
<p>缺点: 可能会使二级索引上的读取查询相当昂贵.</p>
<h4 id="基于关键词的次级索引"><a href="#基于关键词的次级索引" class="headerlink" title="基于关键词的次级索引"></a>基于关键词的次级索引</h4><img src="/2020/10/22/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/%E6%8C%89%E5%85%B3%E9%94%AE%E8%AF%8D%E7%9A%84%E4%BA%8C%E7%BA%A7%E7%B4%A2%E5%BC%95.png" srcset="/img/loading.gif" class="" title="按关键词的二级索引">

<p>构建一个覆盖所有分区的全局索引, 而不是给每个自己分区创建自己的本地索引.</p>
<p>缺点: 写入速度较慢且较为复杂, 因为写入单个文档现在可能会影响索引的多个分区</p>
<h3 id="分区再平衡"><a href="#分区再平衡" class="headerlink" title="分区再平衡"></a>分区再平衡</h3><p>再平衡一般需要满足:</p>
<ul>
<li>再平衡之后, 负载(数据存储, 读取和写入请求)应该在集群中的节点之间公平地共享.</li>
<li>再平衡发生时, 数据库应该继续接受读取和写入</li>
<li>节点之间只移动必须的数据, 以便快速再平衡, 并减少网络和磁盘 I/O 负载.</li>
</ul>
<h4 id="固定数量的分区"><a href="#固定数量的分区" class="headerlink" title="固定数量的分区"></a>固定数量的分区</h4><p>创建比节点更多的分区, 并为每个节点分配多个分区. 如果一个节点被添加到集群中, 新节点可以从当前每个节点中拿走一些分区, 直到分区再次公平分配. 如果从集群中删除一个节点, 就会把节点中的分区再分配回去.</p>
<img src="/2020/10/22/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/%E5%9B%BA%E5%AE%9A%E6%95%B0%E9%87%8F%E7%9A%84%E5%88%86%E5%8C%BA.png" srcset="/img/loading.gif" class="" title="固定数量的分区">

<p>缺点: 数据集的总大小难以估计, 难以选择正确的分区数.</p>
<h4 id="动态分区"><a href="#动态分区" class="headerlink" title="动态分区"></a>动态分区</h4><p>按键的范围进行分区的数据库会动态创建分区. 当分区增长到超过配置的大小时, 会被分成两个分区, 每个分区约占一般的数据. 相反的, 如果大量数据被删除并且分区缩小到某个阈值以下, 则可以将其与相邻分区合并.</p>
<h4 id="按节点比例分区"><a href="#按节点比例分区" class="headerlink" title="按节点比例分区"></a>按节点比例分区</h4><p>以上两种分区方式, 分区的数量都与节点的数量无关.</p>
<p>每个分区的大小与数据集大小成比例地增长, 而节点数量保持不变, 但是当增加节点数时, 分区将再次变小. 由于较大的数据量通常需要较大数量的节点进行存储, 因此这种方法也使每个分区的大小较为稳定.</p>
<h1 id="分布式系统的麻烦"><a href="#分布式系统的麻烦" class="headerlink" title="分布式系统的麻烦"></a>分布式系统的麻烦</h1><ul>
<li>无法访问的网络</li>
<li>时钟和时序问题</li>
</ul>
<h2 id="故障与部分失效"><a href="#故障与部分失效" class="headerlink" title="故障与部分失效"></a>故障与部分失效</h2><p>在分布式系统中, 尽管系统的其他部分工作正常, 单系统的某些部分可能会以某种不可预知的方式被破坏. <strong>(partial failure 部分失效)</strong></p>
<h3 id="不可靠的网络"><a href="#不可靠的网络" class="headerlink" title="不可靠的网络"></a>不可靠的网络</h3><h4 id="检测故障"><a href="#检测故障" class="headerlink" title="检测故障"></a>检测故障</h4><ul>
<li>负载平衡器需要停止向已死亡的节点转发请求</li>
<li>在单主复制功能的分布式数据库中, 如果主库失效, 则需要将从库之一升级为新主库.</li>
</ul>
<h1 id="一致性与共识-Consistency-and-Consensus"><a href="#一致性与共识-Consistency-and-Consensus" class="headerlink" title="一致性与共识 Consistency and Consensus"></a>一致性与共识 Consistency and Consensus</h1><p><strong>共识(consensus)</strong> : 就是让所有的节点对某件事达成共识.</p>
<h2 id="一致性保证"><a href="#一致性保证" class="headerlink" title="一致性保证"></a>一致性保证</h2><h3 id="线性一致性-强一致性"><a href="#线性一致性-强一致性" class="headerlink" title="线性一致性 = 强一致性"></a>线性一致性 = 强一致性</h3><p>让系统看起来好像只有一个数据副本, 而且所有的操作都是原子性的.</p>
<h4 id="区别-线性一致性-Linearizability-vs-可序列化-Serializability"><a href="#区别-线性一致性-Linearizability-vs-可序列化-Serializability" class="headerlink" title="区别 线性一致性(Linearizability) vs. 可序列化(Serializability)"></a>区别 线性一致性(Linearizability) vs. 可序列化(Serializability)</h4><ul>
<li>可序列化<ul>
<li>Serializability 是事务的隔离属性.</li>
<li>它确保事务的行为, 与它们按照<strong>某种</strong>顺序依次执行的结果相同. 这种执行顺序可以与事务实际执行的顺序不同.</li>
<li>保证即使事务可以并行执行, 最终的结果也是一样的, 就好像它们没有任何并发性, 连续挨个执行一样.</li>
</ul>
</li>
<li>线性一致性<ul>
<li>不会将操作组合成事务. 是在单个对象上面的单个操作保证</li>
</ul>
</li>
</ul>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2020/10/25/Raft%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%80%E8%87%B4%E6%80%A7/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Raft分布式一致性</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2020/08/30/Linux%E4%B8%AD%E7%9A%84IO/">
                        <span class="hidden-mobile">Linux中的IO</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>



</body>
</html>
